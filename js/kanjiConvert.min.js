(function(a){a.fn.autoKana=function(n,e,r){var i=a.extend({katakana:false},r);var t=new RegExp("[^ 　ぁあ-んー]","g");var u=new RegExp("[ぁぃぅぇぉっゃゅょ]","g");var o,f,l=false,v=null,s=true,c,h,y,g;o=a(n);f=a(e);l=true;I();o.blur(m);o.focus(S);o.keydown(A);function p(){l=true}function k(){l=false}function w(a){var n=a||window.event;if(a){var e=Event.element(a);if(e.checked){l=true}else{l=false}}else{l=!l}}function b(a){if(!s){if(Math.abs(h.length-a.length)>1){var n=a.join("").replace(u,"").split("");if(Math.abs(h.length-n.length)>1){R()}}else{if(h.length==c.length&&h.join("")!=c){if(c.match(t)){R()}}}}}function d(){var a,n;a=o.val();if(a==""){I();E()}else{a=x(a);if(c==a){return}else{c=a;if(!s){n=a.replace(t,"").split("");b(n);E(n)}}}}function j(){clearInterval(v)}function m(a){j()}function S(a){M();C()}function A(a){if(s){M()}}function z(a){return a>=12353&&a<=12435||a==12445||a==12446}function x(a){if(a.indexOf(y)!==-1){return a.replace(y,"")}else{var n,e,r;e=y.split("");r=a.split("");for(n=0;n<e.length;n++){if(e[n]==r[n]){r[n]=""}}return r.join("")}}function C(){var a=this;v=setInterval(d,30)}function E(a){if(!s){if(a){h=a}if(l){var n=K(g+h.join(""));f.val(n)}}}function I(){g="";s=false;y="";c="";h=[]}function M(){g=f.val();s=false;y=o.val()}function R(){g=g+h.join("");s=true;h=[]}function K(a){if(i.katakana){var n,e,r;r=new String;for(e=0;e<a.length;e++){n=a.charCodeAt(e);if(z(n)){r+=String.fromCharCode(n+96)}else{r+=a.charAt(e)}}return r}else{return a}}};a.fn.hiragana=function(n,e,r){var i=a(n);var t=a(e);t.val("");var u=null;var o=false;if(null!=r){u=a(r);u.val("");o=true}var f=i.val();if(null==f||""==f){return}var l=f.length;var v=[];var s=[];var c={"ア":"あ","イ":"い","ウ":"う","エ":"え","オ":"お","カ":"か","キ":"キ","ク":"く","ケ":"け","コ":"こ","サ":"さ","シ":"し","ス":"す","セ":"せ","ソ":"そ","タ":"た","チ":"ち","ツ":"つ","テ":"て","ト":"と","ナ":"な","二":"に","ヌ":"ぬ","ネ":"ね","ノ":"の","ハ":"は","ヒ":"ひ","フ":"ふ","へ":"へ","ホ":"ほ","マ":"ま","ミ":"み","ム":"む","メ":"め","モ":"も","ヤ":"や","ユ":"ゆ","ヨ":"よ","ラ":"ら","リ":"り","ル":"る","レ":"れ","ロ":"ろ","ワ":"わ","ヲ":"を","ン":"ん","ガ":"が","ギ":"ぎ","グ":"ぐ","ゲ":"げ","ゴ":"ご","ザ":"ざ","ジ":"じ","ズ":"ず","ゼ":"ぜ","ゾ":"ぞ","ダ":"だ","ヂ":"ぢ","ヅ":"づ","デ":"で","ド":"ど","バ":"ば","ビ":"び","ブ":"ぶ","べ":"べ","ボ":"ぼ","パ":"ぱ","ピ":"ぴ","プ":"ぷ","ぺ":"ぺ","ポ":"ぽ","ッ":"っ","キャ":"きゃ","キュ":"きゅ","キョ":"きょ","シャ":"しゃ","シュ":"しゅ","ショ":"しょ","チャ":"ちゃ","チユ":"ちゅ","チョ":"ちょ","ニャ":"にゃ","ニュ":"にゅ","ニョ":"にょ","ヒャ":"ひゃ","ヒュ":"ひゅ","ヒョ":"ひょ","ミャ":"みゃ","ミュ":"みゅ","ミョ":"みょ","リャ":"りゃ","リュ":"りゅ","リョ":"りょ","ギャ":"ぎゃ","ギュ":"ぎゅ","ギョ":"ぎょ","ジャ":"じゃ","ジュ":"じゅ","ジョ":"じょ","ビャ":"びゃ","ビュ":"びゅ","ビョ":"びょ","ピャ":"ぴゃ","ピュ":"ぴゅ","ピョ":"ぴょ","ァ":"ぁ","ィ":"ぃ","ゥ":"ぅ","ェ":"ぇ","ォ":"ぉ","ツァ":"つぁ","ファ":"ふぁ","ウィ":"うぃ","ティ":"てぃ","フィ":"ふぃ","ディ":"でぃ","トゥ":"とぅ","ドゥ":"どぅ","デュ":"でゅ","ウェ":"うぇ","シェ":"しぇ","チェ":"ちぇ","ツェ":"つぇ","フェ":"ふぇ","ジェ":"じぇ","ウォ":"うぉ","ツォ":"つぉ","フォ":"ふぉ"};var h={"ア":"a","イ":"i","ウ":"u","エ":"e","オ":"o","カ":"ka","キ":"ki","ク":"ku","ケ":"ke","コ":"ko","サ":"sa","シ":"shi","ス":"su","セ":"se","ソ":"so","タ":"ta","チ":"chi","ツ":"tsu","テ":"te","ト":"to","ナ":"na","二":"ni","ヌ":"nu","ネ":"ne","ノ":"no","ハ":"ha","ヒ":"hi","フ":"fu","へ":"he","ホ":"ho","マ":"ma","ミ":"mi","ム":"mu","メ":"me","モ":"mo","ヤ":"ya","ユ":"yu","ヨ":"yo","ラ":"ra","リ":"ri","ル":"ru","レ":"re","ロ":"ro","ワ":"wa","ヲ":"o","ン":"n","ガ":"ga","ギ":"gi","グ":"gu","ゲ":"ge","ゴ":"go","ザ":"za","ジ":"ji","ズ":"zu","ゼ":"ze","ゾ":"zo","ダ":"da","ヂ":"ji","ヅ":"zu","デ":"de","ド":"do","バ":"ba","ビ":"bi","ブ":"bu","べ":"be","ボ":"bo","パ":"pa","ピ":"pi","プ":"pu","ぺ":"pe","ポ":"po","キャ":"kya","キュ":"kyu","キョ":"kyo","シャ":"sha","シュ":"shu","ショ":"sho","チャ":"cha","チユ":"chu","チョ":"cho","ニャ":"nya","ニュ":"nyu","ニョ":"nyo","ヒャ":"hya","ヒュ":"hyu","ヒョ":"hyo","ミャ":"mya","ミュ":"myu","ミョ":"myo","リャ":"rya","リュ":"ryu","リョ":"ryo","ギャ":"gya","ギュ":"gyu","ギョ":"gyo","ジャ":"ja","ジュ":"ju","ジョ":"jo","ビャ":"bya","ビュ":"byu","ビョ":"byo","ピャ":"pya","ピュ":"pyu","ピョ":"pyo","ツァ":"tsa","ファ":"fa","ウィ":"wi","ティ":"ti","フィ":"fi","ディ":"di","トゥ":"tu","ドゥ":"du","デュ":"dyu","ウェ":"we","シェ":"she","チェ":"che","ツェ":"tse","フェ":"fe","ジェ":"je","ウォ":"wo","ツォ":"tso","フォ":"fo"};var y=new Array("ャ","ュ","ョ");v.push(c);s.push(h);var g=new Array;var p=new Array;var k=null;if(null!=u){k=new Array}for(var w=0;w<l;w++){g[w]=f.substr(w,1)}var b="アイウエオヤユヨワヲダヂヅデド";var d="ャュョ";var j="ツフウテデトドシチツ";var m="ァィゥュェォ";var S=null;for(var w=0;w<g.length;w++){var A=g[w];var z=null;var x=null;if(w<g.length-1){z=g[w+1];x=z.toString()}var C=A.toString();if(!b.contains(C)&&d.contains(x)){var E=C+x;p[w]=v[0][E];S=x;if(o){k[w]=s[0][E]}}else if(j.contains(C)&&m.contains(x)){var E=C+x;p[w]=v[0][E];S=x;if(o){k[w]=s[0][E]}}else{if(C!=S){p[w]=v[0][C];if(o){if(C=="ッ"){var I=g[w+1];var M=I.toString();var R=s[0][M];k[w]=R.substr(0,1)}else{k[w]=s[0][C]}}}}}var K=p.toString();var O;if(o){O=k.toString()}t.val(K.replace(/\,/g,""));u.val(O.replace(/\,/g,""))}})(jQuery);