(function($){$.fn.autoKana=function(element1,element2,passedOptions){var options=$.extend({'katakana':false},passedOptions);var kana_extraction_pattern=new RegExp('[^ 　ぁあ-んー]','g');var kana_compacting_pattern=new RegExp('[ぁぃぅぇぉっゃゅょ]','g');var elName,elKana,active=false,timer=null,flagConvert=true,input,values,ignoreString,baseKana;elName=$(element1);elKana=$(element2);active=true;_stateClear();elName.blur(_eventBlur);elName.focus(_eventFocus);elName.keydown(_eventKeyDown);function start(){active=true};function stop(){active=false};function toggle(event){var ev=event||window.event;if(event){var el=Event.element(event);if(el.checked){active=true}else{active=false}}else{active=!active}};function _checkConvert(new_values){if(!flagConvert){if(Math.abs(values.length-new_values.length)>1){var tmp_values=new_values.join('').replace(kana_compacting_pattern,'').split('');if(Math.abs(values.length-tmp_values.length)>1){_stateConvert()}}else{if(values.length==input.length&&values.join('')!=input){if(input.match(kana_extraction_pattern)){_stateConvert()}}}}};function _checkValue(){var new_input,new_values;new_input=elName.val();if(new_input==''){_stateClear();_setKana()}else{new_input=_removeString(new_input);if(input==new_input){return}else{input=new_input;if(!flagConvert){new_values=new_input.replace(kana_extraction_pattern,'').split('');_checkConvert(new_values);_setKana(new_values)}}}};function _clearInterval(){clearInterval(timer)};function _eventBlur(event){_clearInterval()};function _eventFocus(event){_stateInput();_setInterval()};function _eventKeyDown(event){if(flagConvert){_stateInput()}};function _isHiragana(chara){return((chara>=12353&&chara<=12435)||chara==12445||chara==12446)};function _removeString(new_input){if(new_input.indexOf(ignoreString)!==-1){return new_input.replace(ignoreString,'')}else{var i,ignoreArray,inputArray;ignoreArray=ignoreString.split('');inputArray=new_input.split('');for(i=0;i<ignoreArray.length;i+=1){if(ignoreArray[i]==inputArray[i]){inputArray[i]=''}}return inputArray.join('')}};function _setInterval(){var self=this;timer=setInterval(_checkValue,30)};function _setKana(new_values){if(!flagConvert){if(new_values){values=new_values}if(active){var _val=_toKatakana(baseKana+values.join(''));elKana.val(_val)}}};function _stateClear(){baseKana='';flagConvert=false;ignoreString='';input='';values=[]};function _stateInput(){baseKana=elKana.val();flagConvert=false;ignoreString=elName.val()};function _stateConvert(){baseKana=baseKana+values.join('');flagConvert=true;values=[]};function _toKatakana(src){if(options.katakana){var c,i,str;str=new String;for(i=0;i<src.length;i+=1){c=src.charCodeAt(i);if(_isHiragana(c)){str+=String.fromCharCode(c+96)}else{str+=src.charAt(i)}}return str}else{return src}}};$.fn.hiragana=function(kataNaka,hiragana,rouma){var kataNakaObj=$(kataNaka);var hiraganaObj=$(hiragana);hiraganaObj.val('');var roumaObj=null;var roumaFlag=false;if(null!=rouma){roumaObj=$(rouma);roumaObj.val('');roumaFlag=true}var kabna=kataNakaObj.val();if(null==kabna||''==kabna){return}var kanaSize=kabna.length;var hiraganaAll=[];var roumaAll=[];var row={ア:'あ',イ:'い',ウ:'う',エ:'え',オ:'お',カ:'か',キ:'キ',ク:'く',ケ:'け',コ:'こ',サ:'さ',シ:'し',ス:'す',セ:'せ',ソ:'そ',タ:'た',チ:'ち',ツ:'つ',テ:'て',ト:'と',ナ:'な',二:'に',ヌ:'ぬ',ネ:'ね',ノ:'の',ハ:'は',ヒ:'ひ',フ:'ふ',へ:'へ',ホ:'ほ',マ:'ま',ミ:'み',ム:'む',メ:'め',モ:'も',ヤ:'や',ユ:'ゆ',ヨ:'よ',ラ:'ら',リ:'り',ル:'る',レ:'れ',ロ:'ろ',ワ:'わ',ヲ:'を',ン:'ん',ガ:'が',ギ:'ぎ',グ:'ぐ',ゲ:'げ',ゴ:'ご',ザ:'ざ',ジ:'じ',ズ:'ず',ゼ:'ぜ',ゾ:'ぞ',ダ:'だ',ヂ:'ぢ',ヅ:'づ',デ:'で',ド:'ど',バ:'ば',ビ:'び',ブ:'ぶ',べ:'べ',ボ:'ぼ',パ:'ぱ',ピ:'ぴ',プ:'ぷ',ぺ:'ぺ',ポ:'ぽ',ッ:'っ',キャ:'きゃ',キュ:'きゅ',キョ:'きょ',シャ:'しゃ',シュ:'しゅ',ショ:'しょ',チャ:'ちゃ',チユ:'ちゅ',チョ:'ちょ',ニャ:'にゃ',ニュ:'にゅ',ニョ:'にょ',ヒャ:'ひゃ',ヒュ:'ひゅ',ヒョ:'ひょ',ミャ:'みゃ',ミュ:'みゅ',ミョ:'みょ',リャ:'りゃ',リュ:'りゅ',リョ:'りょ',ギャ:'ぎゃ',ギュ:'ぎゅ',ギョ:'ぎょ',ジャ:'じゃ',ジュ:'じゅ',ジョ:'じょ',ビャ:'びゃ',ビュ:'びゅ',ビョ:'びょ',ピャ:'ぴゃ',ピュ:'ぴゅ',ピョ:'ぴょ',ァ:'ぁ',ィ:'ぃ',ゥ:'ぅ',ェ:'ぇ',ォ:'ぉ',ツァ:'つぁ',ファ:'ふぁ',ウィ:'うぃ',ティ:'てぃ',フィ:'ふぃ',ディ:'でぃ',トゥ:'とぅ',ドゥ:'どぅ',デュ:'でゅ',ウェ:'うぇ',シェ:'しぇ',チェ:'ちぇ',ツェ:'つぇ',フェ:'ふぇ',ジェ:'じぇ',ウォ:'うぉ',ツォ:'つぉ',フォ:'ふぉ'};var roumaRow={ア:'a',イ:'i',ウ:'u',エ:'e',オ:'o',カ:'ka',キ:'ki',ク:'ku',ケ:'ke',コ:'ko',サ:'sa',シ:'shi',ス:'su',セ:'se',ソ:'so',タ:'ta',チ:'chi',ツ:'tsu',テ:'te',ト:'to',ナ:'na',二:'ni',ヌ:'nu',ネ:'ne',ノ:'no',ハ:'ha',ヒ:'hi',フ:'fu',へ:'he',ホ:'ho',マ:'ma',ミ:'mi',ム:'mu',メ:'me',モ:'mo',ヤ:'ya',ユ:'yu',ヨ:'yo',ラ:'ra',リ:'ri',ル:'ru',レ:'re',ロ:'ro',ワ:'wa',ヲ:'o',ン:'n',ガ:'ga',ギ:'gi',グ:'gu',ゲ:'ge',ゴ:'go',ザ:'za',ジ:'ji',ズ:'zu',ゼ:'ze',ゾ:'zo',ダ:'da',ヂ:'ji',ヅ:'zu',デ:'de',ド:'do',バ:'ba',ビ:'bi',ブ:'bu',べ:'be',ボ:'bo',パ:'pa',ピ:'pi',プ:'pu',ぺ:'pe',ポ:'po',キャ:'kya',キュ:'kyu',キョ:'kyo',シャ:'sha',シュ:'shu',ショ:'sho',チャ:'cha',チユ:'chu',チョ:'cho',ニャ:'nya',ニュ:'nyu',ニョ:'nyo',ヒャ:'hya',ヒュ:'hyu',ヒョ:'hyo',ミャ:'mya',ミュ:'myu',ミョ:'myo',リャ:'rya',リュ:'ryu',リョ:'ryo',ギャ:'gya',ギュ:'gyu',ギョ:'gyo',ジャ:'ja',ジュ:'ju',ジョ:'jo',ビャ:'bya',ビュ:'byu',ビョ:'byo',ピャ:'pya',ピュ:'pyu',ピョ:'pyo',ツァ:'tsa',ファ:'fa',ウィ:'wi',ティ:'ti',フィ:'fi',ディ:'di',トゥ:'tu',ドゥ:'du',デュ:'dyu',ウェ:'we',シェ:'she',チェ:'che',ツェ:'tse',フェ:'fe',ジェ:'je',ウォ:'wo',ツォ:'tso',フォ:'fo'};var yayuyoArray=['ャ','ュ','ョ'];hiraganaAll.push(row);roumaAll.push(roumaRow);var kanaArray=[];var hiraArray=[];var roumaArray=null;if(null!=roumaObj){roumaArray=[]}for(var i=0;i<kanaSize;i+=1){kanaArray[i]=kabna.substr(i,1)}var str1='アイウエオヤユヨワヲダヂヅデド';var str2='ャュョ';var str3='ツフウテデトドシチツ';var str4='ァィゥュェォ';var tmp=null;for(var i=0;i<kanaArray.length;i+=1){var obj1=kanaArray[i];var obj2=null;var keyStr2=null;if(i<kanaArray.length-1){obj2=kanaArray[i+1];keyStr2=obj2.toString()}var keyStr=obj1.toString();if(!str1.contains(keyStr)&&str2.contains(keyStr2)){var joinKey=keyStr+keyStr2;hiraArray[i]=hiraganaAll[0][joinKey];tmp=keyStr2;if(roumaFlag){roumaArray[i]=roumaAll[0][joinKey]}}else if(str3.contains(keyStr)&&str4.contains(keyStr2)){var joinKey=keyStr+keyStr2;hiraArray[i]=hiraganaAll[0][joinKey];tmp=keyStr2;if(roumaFlag){roumaArray[i]=roumaAll[0][joinKey]}}else{if(keyStr!=tmp){hiraArray[i]=hiraganaAll[0][keyStr];if(roumaFlag){if(keyStr=='ッ'){var kana_obj=kanaArray[i+1];var kana_val=kana_obj.toString();var rouma_val=roumaAll[0][kana_val];roumaArray[i]=rouma_val.substr(0,1)}else{roumaArray[i]=roumaAll[0][keyStr]}}}}}var hiraValue=hiraArray.toString();var roumaValue;if(roumaFlag){roumaValue=roumaArray.toString()}hiraganaObj.val(hiraValue.replace(/\,/g,''));roumaObj.val(roumaValue.replace(/\,/g,''))}})(jQuery);